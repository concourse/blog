<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Introduction to Task Inputs and Outputs | Concourse Blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Introduction to Task Inputs and Outputs" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Understanding how task inputs and outputs work in Concourse can be a little confusing initially. This post will walk you through a few example pipelines to show you how inputs and outputs work within a single Concourse job. By the end you should understand how inputs and outputs work within the context of a single job." />
<meta property="og:description" content="Understanding how task inputs and outputs work in Concourse can be a little confusing initially. This post will walk you through a few example pipelines to show you how inputs and outputs work within a single Concourse job. By the end you should understand how inputs and outputs work within the context of a single job." />
<link rel="canonical" href="http://localhost:4000/2020/05/25/introduction-to-task-inputs-and-outputs.html" />
<meta property="og:url" content="http://localhost:4000/2020/05/25/introduction-to-task-inputs-and-outputs.html" />
<meta property="og:site_name" content="Concourse Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-25T13:14:40-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Introduction to Task Inputs and Outputs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-05-25T13:14:40-04:00","datePublished":"2020-05-25T13:14:40-04:00","description":"Understanding how task inputs and outputs work in Concourse can be a little confusing initially. This post will walk you through a few example pipelines to show you how inputs and outputs work within a single Concourse job. By the end you should understand how inputs and outputs work within the context of a single job.","headline":"Introduction to Task Inputs and Outputs","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/05/25/introduction-to-task-inputs-and-outputs.html"},"url":"http://localhost:4000/2020/05/25/introduction-to-task-inputs-and-outputs.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Concourse Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Concourse Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Introduction to Task Inputs and Outputs</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-05-25T13:14:40-04:00" itemprop="datePublished">May 25, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Understanding how task inputs and outputs work in Concourse can be a little confusing initially. This post will walk you through a few example pipelines to show you how inputs and outputs work within a single Concourse job. By the end you should understand how inputs and outputs work within the context of a single job.</p>

<p>Let’s define some jargon first.</p>

<ul>
  <li><strong>step</strong> : A <a href="https://concourse-ci.org/jobs.html#steps">step</a> is a container running code within the context of a Concourse job. A <a href="https://concourse-ci.org/jobs.html#steps">step</a> may have inputs and/or outputs, or neither.</li>
  <li><strong>Job plan</strong> : A list of <a href="https://concourse-ci.org/jobs.html#steps">step</a>s that a job will execute when triggered.</li>
  <li><strong>Inputs and Outputs</strong> : These are directories. Within Concourse they’re generically referred to as <strong>artifacts</strong>. These artifacts are mounted in a <strong>step</strong>’s container under a directory with <em>some-name</em>. You, as a writer of Concourse pipelines, have control over what the name of your artifacts will be. If you’re coming from the Docker world, artifact is synonymous with <a href="https://docs.docker.com/storage/volumes/">volumes</a>.</li>
</ul>

<p>To run the pipelines in the following examples yourself you can get your own Concourse running locally by following the <a href="https://concourse-ci.org/quick-start.html">Quick Start guide</a>. Then use <a href="https://concourse-ci.org/setting-pipelines.html"><code class="language-plaintext highlighter-rouge">fly set-pipeline</code></a> to see the pipelines in action.</p>

<p>Concourse pipelines contain a lot of information. Within each pipeline YAML there are comments to help bring specific lines to your attention.</p>

<h2 id="example-one---two-tasks">Example One - Two Tasks</h2>

<p>This pipeline will show us how to create outputs and pass outputs as inputs to the next <a href="https://concourse-ci.org/jobs.html#steps">step</a>(s) in a <a href="https://concourse-ci.org/jobs.html#schema.job.plan">job plan</a>.</p>

<p>This pipeline has two tasks. The first task outputs a file with the date. The second task reads and prints the contents of the file from the first task.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
jobs:
- name: a-job
  plan:
  - task: create-one-output
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: alpine}
      outputs:
        # Concourse will make an empty dir with this name
        # and save the contents for later steps
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            date &gt; ./the-output/file
  - task: read-ouput-from-previous-step
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: alpine}
      # You must explicitly name the inputs you expect
      # this task to have.
      # If you don't then outputs from previous steps
      # will not appear in the step's container.
      # The name must match the output from the previous step.
      # Try removing or renaming the input to see what happens!
      inputs:
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            cat ./the-output/file
</code></pre></div></div>

<p>Here’s a visual graphic of what happens when the above job is executed.</p>

<figure class="kg-card kg-image-card"><img src=" __GHOST_URL__ /content/images/2020/05/example-one-10.gif" class="kg-image" alt="" loading="lazy" /></figure>
<h2 id="example-two---two-tasks-with-the-same-output-who-wins">Example Two - Two tasks with the same output, who wins?</h2>

<p>This example is to satisfy the curiosity cat inside all of us! Never do this in real life because you’re definitely going to hurt yourself!</p>

<p>There are two jobs in this pipeline. The first job has two <a href="https://concourse-ci.org/jobs.html#steps">step</a>s; both steps will produce an artifact named <code class="language-plaintext highlighter-rouge">the-output</code> in parallel. If you run the <code class="language-plaintext highlighter-rouge">writing-to-the-same-output-in-parallel</code> job multiple times you’ll see the file in <code class="language-plaintext highlighter-rouge">the-output</code> folder changes depending on which of the parallel tasks finished last. Here’s a visualization of the first job.</p>

<figure class="kg-card kg-image-card"><img src=" __GHOST_URL__ /content/images/2020/05/example-two-parallel.gif" class="kg-image" alt="" loading="lazy" /></figure>

<p>The second job is a serial version of the first job. In this job the second task always wins because it’s the last task that outputs <code class="language-plaintext highlighter-rouge">the-output</code>, so only <code class="language-plaintext highlighter-rouge">file2</code> will be in <code class="language-plaintext highlighter-rouge">the-output</code> directory in the last <a href="https://concourse-ci.org/jobs.html#steps">step</a> in the <a href="https://concourse-ci.org/jobs.html#schema.job.plan">job plan</a>.</p>

<figure class="kg-card kg-image-card"><img src=" __GHOST_URL__ /content/images/2020/05/example-two-serial.gif" class="kg-image" alt="" loading="lazy" /></figure>

<p>This pipeline illustrates that you could accidentally overwrite the output from a previous <a href="https://concourse-ci.org/jobs.html#steps">step</a> if you’re not careful with the names of your outputs.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
jobs:
- name: writing-to-the-same-output-in-parallel
  plan:
  # running two tasks that output in parallel?!?
  # who will win??
  - in_parallel:
    - task: create-the-output
      config:
        platform: linux
        image_resource:
          type: registry-image
          source: {repository: busybox}
        outputs:
          - name: the-output
        run:
          path: /bin/sh
          args:
            - -cx
            - |
              ls -lah
              date &gt; ./the-output/file1
    - task: also-create-the-output
      config:
        platform: linux
        image_resource:
          type: registry-image
          source: {repository: busybox}
        outputs:
          - name: the-output
        run:
          path: /bin/sh
          args:
            - -cx
            - |
              ls -lah
              date &gt; ./the-output/file2
  # run this job multiple times to see which
  # previous task wins each time
  - task: read-ouput-from-previous-step
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      inputs:
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah ./the-output
            echo "Get ready to error!"
            cat ./the-output/file1 ./the-output/file2

- name: writing-to-the-same-output-serially
  plan:
  - task: create-one-output
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      outputs:
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            date &gt; ./the-output/file1
  - task: create-another-output
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      outputs:
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            date &gt; ./the-output/file2
  - task: read-ouput-from-previous-step
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      inputs:
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah ./the-output
            echo "Get ready to error!"
            cat ./the-output/file1 ./the-output/file2
</code></pre></div></div>

<h2 id="example-three---inputoutput-name-mapping">Example Three - Input/Output Name Mapping</h2>

<p>Sometimes the names of inputs and outputs don’t match, or they do match and you don’t want them overwriting each other, like in the previous example. That’s when <a href="https://concourse-ci.org/jobs.html#schema.step.task-step.input_mapping"><code class="language-plaintext highlighter-rouge">input_mapping</code></a> and <a href="https://concourse-ci.org/jobs.html#schema.step.task-step.output_mapping"><code class="language-plaintext highlighter-rouge">output_mapping</code></a> become helpful. Both of these features map the inputs/outputs in the task’s config to some artifact name in the <a href="https://concourse-ci.org/jobs.html#schema.job.plan">job plan</a>.</p>

<p>This pipeline has one job with four tasks.</p>

<p>The first task outputs a file with the date to the <code class="language-plaintext highlighter-rouge">the-output</code> directory. <code class="language-plaintext highlighter-rouge">the-output</code> is mapped to the new name <code class="language-plaintext highlighter-rouge">demo-disk</code>.  The artifact <code class="language-plaintext highlighter-rouge">demo-disk</code> is now available in the rest of the <a href="https://concourse-ci.org/jobs.html#schema.job.plan">job plan</a> for future <a href="https://concourse-ci.org/jobs.html#steps">step</a>s to take as inputs. The remaining steps do this in various ways.</p>

<p>The second task reads and prints the contents of the file under the new name <code class="language-plaintext highlighter-rouge">demo-disk</code>.</p>

<p>The third task reads and prints the contents of the file under another name, <code class="language-plaintext highlighter-rouge">generic-input</code>. The <code class="language-plaintext highlighter-rouge">demo-disk</code> artifact in the <a href="https://concourse-ci.org/jobs.html#schema.job.plan">job plan</a> is mapped to <code class="language-plaintext highlighter-rouge">generic-input</code>.</p>

<p>The fourth task tries to use the artifact named <code class="language-plaintext highlighter-rouge">the-output</code> as its input. This task fails to even start because there was no artifact with the name <code class="language-plaintext highlighter-rouge">the-output</code> available in the <a href="https://concourse-ci.org/jobs.html#schema.job.plan">job plan</a>; it was remapped to <code class="language-plaintext highlighter-rouge">demo-disk</code>.</p>

<p>Here’s a visualization of the job.</p>

<figure class="kg-card kg-image-card"><img src=" __GHOST_URL__ /content/images/2020/05/example-three-1.gif" class="kg-image" alt="" loading="lazy" /></figure>

<p>Here’s the pipeline YAML for you to run on your local Concourse.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
jobs:
- name: a-job
  plan:
  - task: create-one-output
    # The task config has the artifact `the-output`
    # output_mapping will rename `the-output` to `demo-disk`
    # in the rest of the job's plan
    output_mapping:
      the-output: demo-disk
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      outputs:
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            date &gt; ./the-output/file
  # this task expects the artifact `demo-disk` so no mapping is needed
  - task: read-ouput-from-previous-step
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      inputs:
        - name: demo-disk
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            cat ./demo-disk/file
  - task: rename-and-read-output
    # This task expects the artifact `generic-input`.
    # input_mapping will map the tasks `generic-input` to
    # the job plans `demo-disk` artifact
    input_mapping:
      generic-input: demo-disk
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      inputs:
        - name: generic-input
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            cat ./generic-input/file
  - task: try-and-read-the-output
    input_mapping:
      generic-input: demo-disk
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      # `the-output` is not available in the job plan
      # so this task will error while initializing
      # since there's no artiact named `the-output` in
      # the job's plan
      inputs:
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            cat ./generic-input/file
</code></pre></div></div>

<h2 id="example-four---can-you-add-files-to-an-existing-output-artifact">Example Four - Can you add files to an existing output artifact?</h2>

<p>This pipeline will also have two jobs in order to illustrate this point. What happens if we add a file to an output? If you think back to example two you may already know the answer.</p>

<p>The first task will create <code class="language-plaintext highlighter-rouge">the-output</code> with <code class="language-plaintext highlighter-rouge">file1</code>. The second task will add <code class="language-plaintext highlighter-rouge">file2</code> to the <code class="language-plaintext highlighter-rouge">the-output</code>. The last task will read the contents of <code class="language-plaintext highlighter-rouge">file1</code> and <code class="language-plaintext highlighter-rouge">file2</code>.</p>

<p>As long as you re-declare the input as an output in the second task you can modify any of your outputs.</p>

<p>This means you can pass something between a bunch of tasks and have each task add or modify something in the artifact.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
jobs:
- name: add-file-to-output
  plan:
  - task: create-one-output
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      outputs:
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            date &gt; ./the-output/file1
  - task: add-file-to-previous-output
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      # this task lists the same artifact as
      # its input and output
      inputs:
        - name: the-output
      outputs:
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            date &gt; ./the-output/file2
  - task: read-ouput-from-previous-step
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      inputs:
        - name: the-output
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah ./the-output
            cat ./the-output/file1 ./the-output/file2
</code></pre></div></div>

<p>Here’s a visualization of the job.</p>

<figure class="kg-card kg-image-card"><img src=" __GHOST_URL__ /content/images/2020/05/example-four.gif" class="kg-image" alt="" loading="lazy" /></figure>
<h2 id="example-five---multiple-outputs">Example Five - Multiple Outputs</h2>

<p>What happens if you have a task that has multiple outputs and a second task that only lists one of the outputs? Does the second task get the extra outputs from the first task?</p>

<p>The answer is no. A task will only get the artifacts that match the name of the inputs listed in the task’s config.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
jobs:
- name: multiple-outputs
  plan:
  - task: create-three-outputs
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      outputs:
        - name: the-output-1
        - name: the-output-2
        - name: the-output-3
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah
            date &gt; ./the-output-1/file
            date &gt; ./the-output-2/file
            date &gt; ./the-output-3/file
  - task: take-one-output
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      # only one of the three outputs are
      # listed as inputs
      inputs:
        - name: the-output-1
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah ./
            cat ./the-output-1/file
  - task: take-two-outputs
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      # this task pulls in the other
      # two outputs, just for fun!
      inputs:
        - name: the-output-2
        - name: the-output-3
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah ./
            cat ./the-output-2/file
            cat ./the-output-3/file
</code></pre></div></div>

<p>Here’s a visualization of the above job.</p>

<figure class="kg-card kg-image-card"><img src=" __GHOST_URL__ /content/images/2020/05/example-five.gif" class="kg-image" alt="" loading="lazy" /></figure>
<h2 id="example-six---get-steps">Example Six - Get Steps</h2>

<p>The majority of Concourse pipelines have at least one resource, which means they have at least one <a href="https://concourse-ci.org/jobs.html#get-step">get step</a>. Using a get step in a job makes an artifact with the name of the get step available for later steps in the <a href="https://concourse-ci.org/jobs.html#schema.job.plan">job plan</a> to consume as inputs.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
resources:
- name: concourse-examples
  type: git
  source: {uri: "https://github.com/concourse/examples"}

jobs:
- name: get-step
  plan:
  # there will be an artifact named
  # "concourse-examples" available in the job plan
  - get: concourse-examples
  - task: take-one-output
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: {repository: busybox}
      inputs:
        - name: concourse-examples
      run:
        path: /bin/sh
        args:
          - -cx
          - |
            ls -lah ./
            cat ./concourse-examples/README.md
</code></pre></div></div>

<p>Here’s a visualization for the above job.</p>

<figure class="kg-card kg-image-card"><img src=" __GHOST_URL__ /content/images/2020/05/example-six.gif" class="kg-image" alt="" loading="lazy" /></figure>

<p>I hope you found these example helpful with figuring out how inputs and outputs work within a single Concourse job.</p>


  </div><a class="u-url" href="/2020/05/25/introduction-to-task-inputs-and-outputs.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Concourse Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Concourse Blog</li><li><a class="u-email" href="mailto:noreply@blog.concourse-ci.org">noreply@blog.concourse-ci.org</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/concourse"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">concourse</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Come Fly The Friendly CI</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
